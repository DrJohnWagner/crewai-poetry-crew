task_inspire:
    description: |
        Based on the user prompt, use the muse agent to generate 3
        emotionally distinct poetic concepts in a CONCEPTS section.

        User prompt: {PROMPT}

        {GLOBAL_META_GUARDRAILS}
    expected_output: |
        A CONCEPTS section with 3 numbered, single-paragraph poetic
        universes, each grounded in a different emotional arc.
    agent: muse
    context: []

task_summarise:
    description: |
        Review the Muse's CONCEPTS section and distill each numbered concept
        into a minimal emotional "seed" (arc + anchors + atmosphere) suitable
        for the poet.

        Use the summariser agent’s rules: reduce, don’t retell.

        {GLOBAL_META_GUARDRAILS}
    expected_output: |
        A SEEDS section containing 3 compact emotional briefs, each with:
            - Arc
            - Anchors
            - Atmosphere
    agent: summariser
    context:
        - task_inspire

task_write:
    description: |
        You have received 3 distilled emotional briefs. Choose EXACTLY ONE
        and explain your choice in a CHOSEN CONCEPT section (2–4 sentences).

        Then create an entirely new poem based on the chosen brief. Use its
        emotional arc and anchors only as pressure, not content. Do not
        retell, paraphrase, or narrate.

        Follow the poet agent’s persona logic and OUTPUT RULES.

        {GLOBAL_META_GUARDRAILS}
        - OUTPUT may contain ONLY the labeled sections required by your agent’s
          OUTPUT RULES. Nothing else.
    expected_output: |
        A CHOSEN CONCEPT section, then the required REVISED POEM and POEM TITLE
        sections produced by the poet agent.

    agent: poet
    context:
      - task_summarise

task_architect_one:
  description: |
    Perform the first architectural pass on the poet’s initial poem and title.
    Follow the architect agent’s rules completely.

    {GLOBAL_META_GUARDRAILS}

  expected_output: |
    REVISED POEM, POEM TITLE, and ARCHITECT'S NOTES sections.

  agent: architect
  context:
    - task_write

task_edit_one:
  description: |
    You have received the architect’s first-pass output, containing:
    - a REVISED POEM section (markdown code block),
    - a POEM TITLE section,
    - an ARCHITECT'S NOTES section.

    Your job is to perform the first editorial pass.

    The editor agent will:
    - extract the poem and title from the labeled sections,
    - extract the architect’s notes exactly,
    - evaluate ONLY this version of the poem,
    - produce a concise set of NEW optional editorial suggestions,
    - output all sections in the required labeled format.

    Rely entirely on the editor agent’s defined behavior and output rules.

    {GLOBAL_META_GUARDRAILS}
  expected_output: |
    Four labeled sections:
    FORMATTED POEM, POEM TITLE, ARCHITECT'S NOTES, and EDITOR'S NOTES.
  agent: editor
  context:
    - task_architect_one

task_revise:
    description: |
        Using the formatted poem, the incoming poem title,
        the architect’s notes, and the editor’s notes,
        create a fully revised version of the poem.

        This is a persona-driven revision:
        - Adjust wording, breath, pacing, image-logic, or structure
          only as the persona genuinely demands.
        - Preserve the emotional field and arc established so far.
        - Treat the architect’s and editor’s notes as guidance, not text to copy.

        Produce:
        - a REVISED POEM
        - a POEM TITLE

        Follow all poet agent OUTPUT RULES.

        {GLOBAL_META_GUARDRAILS}
    expected_output: |
        The required REVISED POEM and POEM TITLE sections produced by the poet agent.

    agent: poet
    context:
      - task_edit_one

task_architect_two:
  description: |
    Perform the second architectural pass on the poet’s revised poem and title.
    Follow the architect agent’s rules completely.

    {GLOBAL_META_GUARDRAILS}

  expected_output: |
    REVISED POEM, POEM TITLE, and ARCHITECT'S NOTES.

  agent: architect
  context:
    - task_revise

task_edit_two:
  description: |
    You have received the architect’s second-pass output, containing:
    - a REVISED POEM section (markdown code block),
    - a POEM TITLE section,
    - an ARCHITECT'S NOTES section.

    Your job is to perform the second editorial pass.

    The editor agent will:
    - extract the poem and title,
    - extract the architect’s notes exactly,
    - create a new set of optional editorial suggestions that respond ONLY
      to this current version of the poem,
    - avoid simply repeating earlier suggestions verbatim,
    - output all sections in the required labeled format.

    The editor MUST rely solely on the current poem and architect notes,
    not any previous draft or suggestion.

    {GLOBAL_META_GUARDRAILS}
  expected_output: |
    Four labeled sections:
    FORMATTED POEM, POEM TITLE, ARCHITECT'S NOTES, and EDITOR'S NOTES.
  agent: editor
  context:
    - task_architect_two

task_finalise:
    description: |
        Create the final version of the poem using:
        - the formatted poem,
        - the incoming poem title,
        - the architect’s notes,
        - the editor’s notes.

        Produce:
        - a REVISED POEM (a full persona-driven revision: adjust wording or form only as the persona genuinely demands),
        - a revised POEM TITLE,
        - an AUTHOR NOTES section.

        Follow all poet agent OUTPUT RULES.

        AUTHOR NOTES must be a short, polished, public-facing note suitable for a literary magazine or book. 
        They are not a revision log.

        Requirements for AUTHOR NOTES:
        - Written in a calm, reflective voice that speaks ABOUT the poem from outside it.
        - Do NOT use the poem’s persona or speaker voice.
        - May use first person (“I wanted this poem to…”) or third person (“This poem explores…”), but never mention agents, models, or the pipeline.
        - Focus on the poem’s emotional, philosophical, or structural intentions.
        - Do NOT describe edits, line changes, or process steps.
        - Length: one coherent paragraph, 2–6 sentences.

        The goal of the AUTHOR NOTES is to give readers a thoughtful entry point into the finished poem.

        {GLOBAL_META_GUARDRAILS}
    expected_output: |
        REVISED POEM, POEM TITLE, and AUTHOR NOTES sections.

    agent: poet
    context:
        - task_edit_two

task_review:
    description: |
        You have received the final poem output from `task_finalise`,
        which includes at least:
        - a REVISED POEM section (markdown code block), and
        - a POEM TITLE section.

        Using the critic agent, write a sophisticated 300–500 word
        literary review suitable for a prestigious journal.

        You MUST follow the critic agent’s OUTPUT RULES:
        - extract the poem text from the REVISED POEM section and the title
          from the POEM TITLE section,
        - analyse only what is on the page (no editing or suggestions),
        - produce a headline and a full review.

        {GLOBAL_META_GUARDRAILS}
    expected_output: |
        Two labeled sections:
        CRITIC TITLE and CRITIC REVIEW, each ending with '---' as per
        the critic agent’s strict output rules.
    agent: critic
    context:
        - task_finalise

task_publish:
    description: |
        Create a final markdown file by combining:
        (1) the poet’s full output block from task_finalise, and
        (2) the critic’s full output block from task_review.

        Preserve all formatting EXACTLY. Assemble the file in this order:
          [poet block]
          (blank line)
          ---
          (blank line)
          [critic block]

        Extract the poem title from the POEM TITLE section and derive
        the filename according to the task rules.

        Call the publisher agent with the filename and full markdown string.

        {GLOBAL_META_GUARDRAILS}
    expected_output: |
        Confirmation of Markdown Writer Tool file creation.

    agent: publisher
    context:
        - task_finalise
        - task_review
